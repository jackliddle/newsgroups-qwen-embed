# QWEN-3 Multi-Task Embeddings Demo

**Watch embeddings transform in real-time**: One model, four perspectives. See how task-specific instructions reshape semantic spaceâ€”no fine-tuning required.

ğŸ‘‰ **[View Live Demo](https://jackliddle.github.io/newsgroups-qwen-embed/)** | ğŸ“¦ **[GitHub Repository](https://github.com/jackliddle/newsgroups-qwen-embed)**

## What It Does

This project demonstrates how **task-specific instructions** reshape QWEN-3 embedding spaces:

**Interactive Web App** (4 tasks):
- **Default**: General-purpose embeddings (no instruction)
- **Topic**: Optimized for topic classification
- **Sentiment**: Optimized for sentiment analysis
- **Toxicity**: Optimized for toxicity detection

**Educational Notebook** (2 tasks):
- **Default** vs **Sentiment** comparison
- Hands-on tutorial for learning the API
- Simpler and cheaper for experimentation

## Why This Matters

Traditional embeddings give you one view of your data. Task-specific embeddings let you reorganize the same data for different purposes:

- âœ¨ **Same documents, different organization** based on your task
- ğŸš€ **No model fine-tuning or training required** â€” just change the instruction
- âš¡ **Instant task switching** for rapid experimentation
- ğŸ¯ **Better downstream performance** when embeddings align with your goal
- ğŸ’° **One model, multiple use cases** â€” no need to maintain separate embeddings

The same 800 documents organize as tight topic clusters, smooth sentiment gradients, or toxicity-based groupings depending on the task instruction you provide.

## Features

- ğŸ¯ **Interactive web app** - Click buttons to switch between tasks
- ğŸ“Š **Real-time visualization** - See how embeddings cluster differently per task
- ğŸ’¬ **Hover tooltips** - Read document previews on mouseover
- ğŸ“± **Single-page design** - No scrolling, clean interface
- ğŸš€ **Fast & efficient** - All data pre-generated, instant switching

## Quick Start

### View the Demo

Simply open `docs/index.html` in your browser, or deploy to GitHub Pages:

1. Push to GitHub
2. Go to Settings â†’ Pages
3. Select Source: **Deploy from branch**
4. Branch: **main**, Folder: **/docs**
5. Save and wait for deployment

### Development Setup

```bash
# Install dependencies
poetry install

# Copy .env.example and add your API key
cp .env.example .env
# Edit .env and add your SiliconFlow API key

# Option 1: Run the educational notebook (2 tasks)
poetry run jupyter notebook newsgroups_embeddings_demo.ipynb

# Option 2: Regenerate web app data (4 tasks)
poetry run python scripts/generate_data.py
```

## Project Structure

```
newsgroups-qwen-embed/
â”œâ”€â”€ docs/                           # GitHub Pages web app (4 tasks)
â”‚   â”œâ”€â”€ index.html                  # Single-page app
â”‚   â”œâ”€â”€ data.json                   # Pre-generated 4-task embeddings (~1.18 MB)
â”‚   â””â”€â”€ assets/
â”‚       â”œâ”€â”€ css/style.css           # Styling
â”‚       â””â”€â”€ js/app.js               # Plotly visualization logic
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ generate_data.py            # Web app data generation (4 tasks)
â”œâ”€â”€ qwen_embedder.py                # QWEN-3 embedding client
â”œâ”€â”€ newsgroups_embeddings_demo.ipynb # Educational notebook (2 tasks)
â”œâ”€â”€ .env.example                    # API key template
â”œâ”€â”€ pyproject.toml                  # Poetry dependencies
â””â”€â”€ README.md                       # This file
```

## How It Works

### 1. Data Generation (`scripts/generate_data.py`)

The generation script creates data for the **web app showcase**:
- Loads 800 documents from 10 newsgroup categories
- Embeds each document **4 times** with different task instructions
- Applies UMAP dimensionality reduction (1024D â†’ 2D)
- Saves coordinates and text previews to `docs/data.json`

### 2. Web App (`docs/index.html`)

The **interactive showcase** with **4 tasks**:
- Loads pre-generated data from `data.json`
- Renders interactive Plotly scatter plots
- Switches between 4 tasks on button click
- Shows task-specific explanations

**Performance**: Instant switching (no recomputation needed)
**Data**: Pre-generated by `scripts/generate_data.py`

### 3. Tutorial Notebook (`newsgroups_embeddings_demo.ipynb`)

The **educational tutorial** with **2 tasks**:
- **Hands-on** - Runs embedding code live (doesn't load pre-generated data)
- Explains task-specific embeddings concept
- Embeds 800 documents with 2 tasks (default + sentiment)
- Applies UMAP and creates 2-panel comparison
- No data files saved (educational purposes only)

**Note**: Requires SiliconFlow API key in `.env` file

## Configuration

### Regenerating Data

Edit `scripts/generate_data.py` to customize:

```python
# Modify tasks
TASKS = {
    'default': None,
    'your_task': "Your custom instruction here"
}

# Adjust sample size
N_SAMPLES = 80  # Per category

# Change UMAP parameters
umap.UMAP(
    n_components=2,
    n_neighbors=15,  # Adjust for tighter/looser clusters
    min_dist=0.1,    # Minimum distance between points
    random_state=42
)
```

### API Configuration

In `qwen_embedder.py`:

```python
config = EmbeddingConfig(
    model=QwenModel.SMALL,      # 0.6B or MEDIUM (1.5B)
    batch_size=32,               # Texts per API request
    max_concurrent=10            # Concurrent requests
)
```

## Technical Details

- **Model**: QWEN-3-Embedding-0.6B (1024 dimensions)
- **API**: SiliconFlow
- **Dataset**: 20 Newsgroups (10 categories, 80 docs each = 800 total)
- **Web App**: 4 tasks (Default + Topic + Sentiment + Toxicity)
- **Notebook**: 2 tasks (Default + Sentiment)
- **Reduction**: UMAP (n_neighbors=15, min_dist=0.1)
- **Performance**: Async batching with rate limiting (33 req/sec)

## Key Insights

### What to Look For (Web App - 4 Tasks)

1. **ğŸ¯ Topic Task**: Dramatically improved category separation â€” documents cluster tightly by subject matter with minimal bleed-through. Perfect for classification tasks.
2. **ğŸ˜Š Sentiment Task**: Category boundaries dissolve into a smooth gradient from negative to positive emotional tone. Shows sentiment is orthogonal to topic.
3. **âš ï¸ Toxicity Task**: Reveals discourse civility patterns â€” political/religious discussions cluster differently from technical communities. Style over substance.
4. **ğŸ”· Default**: Balanced general-purpose organization showing semantic similarity without task optimization.

### Questions to Explore

- **Performance impact**: How much would topic-aligned embeddings improve your classifier accuracy?
- **Efficiency gains**: What if you could skip fine-tuning and just change an instruction string?
- **Multi-dimensional meaning**: Why does the same document appear in different positions across tasks?
- **Use case selection**: When should you use task-specific vs default embeddings in production?

### Notebook Learning (2 Tasks)

The notebook provides a simpler comparison (Default vs Sentiment) for hands-on learning:
- Clearer focus on understanding one task instruction
- Try modifying to compare other task pairs (default vs topic, default vs toxicity, etc.)

## Extending the Demo

### Try Different Tasks

Edit the notebook or `scripts/generate_data.py` and modify the task instructions:

```python
# Topic classification
"Identify the topic or theme of the given text"

# Toxicity detection
"Classify the given text as either toxic or not toxic"

# Emotion recognition
"Classify the emotion expressed in the given text into one of the six emotions: anger, fear, joy, love, sadness, and surprise"

# Query-document matching
"Given a web search query, retrieve relevant passages that answer the query"
```

### Add More Categories

Expand the newsgroup categories in `scripts/generate_data.py`:

```python
CATEGORIES = [
    'alt.atheism',
    'comp.graphics',
    'comp.sys.mac.hardware',  # Add more categories
    'comp.windows.x',
    # ... up to 20 categories available
]
```

## References

- [QWEN-3 Embedding arXiv Paper](https://arxiv.org/abs/2506.05176)
- [Official QWEN Repository](https://github.com/QwenLM/Qwen3-Embedding)
- [SiliconFlow API](https://siliconflow.com)
- [20 Newsgroups Dataset](https://scikit-learn.org/stable/datasets/real_world.html#newsgroups-dataset)
- [UMAP Documentation](https://umap-learn.readthedocs.io/)
